<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>実験説明</title>
</head>
<body>
    <h1>実験説明</h1>
    <p><big>以下の説明をよくお読みください。<strong>回答に関わる説明は以降のページでも読み返すことができます</strong></big></p>
    <h2>研究目的と意義</h2>
    <ul>
        <li>本研究は、小説の魅力を明らかにする研究の一環として行っています</li>
        <li>皆さんのご協力により、魅力的な小説を執筆する方法の一端が解明されるかもしれません</li>
    </ul>

    <h2>実験概要</h2>
    <ul>
        <li>文章を読み、その文章の解釈を列挙してもらいます</li>
        <li>1500字前後の文章が全部で4文章、回答パートは全部で8つあります</li>
        <li>最後に数分で終わる事後アンケートがあります</li>
    </ul>
    
    <h2>実験環境</h2>
    <ul>
      <li>場所：読書に集中できる環境</li>
      <li>媒体：PC（スマートフォン等で回答しないでください）</li>
      <li>時間：1時間程度</li>
    </ul>
    
    <h2>回答手順</h2>
    <p><big>概要：読む→「入力→確定」を繰り返す→出尽くしたら回答完了</big></p>
    <ol>
      <li>文章を一読する</li>
      <li>本文章の解釈を<strong>【語句の形式】</strong>で入力する</li>
        <ul>
            <li>語句とは<strong>「単語や短いフレーズ」</strong>を指します（例：たくあん、黄色い、歯ごたえがある）</li>
            <li>具体的な答え方は以降の「解釈の答え方」で述べます</li>
        </ul>
      <li>語句を1つ入力したら<strong>「確定」</strong>ボタンを押す<strong>（確定後の修正不可）</strong></li>
      <li><strong>できる限り多く</strong>上の回答を繰り返します</li>
      <li>解釈が思い浮かばなくなったら<strong>「回答を完了する」</strong>を押す</li>
    </ol>
    <p>上記の手順を理解しましたら、回答方法理解、と下部の入力欄に入力してください（「次へ進む」はまだ押さないでください）</p>

    <h2>解釈の答え方</h2>
    <ul>
        <li>1文章ごとに「主人公」と「空間」の解釈をしてもらいます</li>
        <li>それぞれの回答方針を以下に示します</li>
        <li><strong>【主人公の回答方針】</strong></li>
        <ul>
            <li>主人公に関して思い浮かぶ解釈を自由に書いてください
                <ul>
                    <li>物理的なイメージでも、備わった性質でも、受ける印象でも良いです
                        <ul>
                            <li>例えば、主人公の内面や外見や立場、またそれらの性質や印象など</li>
                        </ul>
                    </li>
                    <li>解釈に間違いはありませんので、思いつくままに回答してください</li>
                    <li>解釈の抽象度は問いません。抽象的な印象でも、固有名詞でも構いません</li>
                    <li>同じ事柄に関して複数の解釈を回答することもできます</li>
                </ul>
            </li>
        </ul>        
        <li><strong>【空間の回答方針】</strong></li>
        <ul>
            
            <li>空間に関して思い浮かぶ解釈を自由に書いてください
                <ul>
                    <li>物理的なイメージでも、備わった性質でも、受ける印象でも良いです
                        <ul>
                            <li>例えば、空間の名称、空間にある物、空間の雰囲気や性質や印象など</li>
                        </ul>
                    </li>
                    <li>解釈に間違いはありませんので、思いつくままに回答してください</li>
                    <li>解釈の抽象度は問いません。抽象的な印象でも、固有名詞でも構いません</li>
                    <li>同じ事柄に関して複数の解釈を回答することもできます</li>
                </ul>
            </li>
        </ul>        
        <li>上記一読しましたら下部の入力欄に、すでに入力したものに続けて、回答方針理解、と入力しておいてください</li>
    </ul>

    <h2>注意事項</h2>
    <ul>
        <li>回答数と回答時間には下限があります。条件を満たすまで進行できません</li>
        <li>回答中に休憩を挟まないでください。回答ページで<strong>10分経過すると新たな回答が不可能</strong>になります（ただし経過後も、調査の進行に必要な個数までは回答できます）</li>
    </ul>
 
    <h2>謝金に関する注意事項</h2>
    <ul>
      <li>本実験では、基本報酬に加えて<strong>追加報酬</strong>を用意しています</li>
      <ul>
        <li>追加報酬は、<strong>空の仕事（アンケートに無回答で提出するだけなど）を後日（1週間以内）直接依頼</strong>することで支払います</li>
        <li>回答された<strong>語句の合計数に応じて追加報酬が変動</strong>します</li>
        <ul>
            <li>49個以下: 0</li>
            <li>50個以上: 100円</li>
            <li>65個以上: 200円</li>
            <li>80個以上: 300円</li>
            <li>95個以上: 400円</li>
        </ul>       
      </ul>
      <li>あまりに無関係な語句が多く回答された場合、謝金は支払えません</li>
      <li>上記一読しましたら下部の入力欄に、すでに入力したものに続けて、謝金同意、と入力して「次へ進む」を押してください</li> 
    </ul>
    
    <label for="understand_key">入力欄</label>
    <input type="text" id="understand_key" placeholder="入力欄" required>
    <button onclick="checkInputAndProceed()">次へ進む</button>

    <script>
        let allowNavigation = false; // ページ遷移を許可するフラグ
        // ページ読み込み時の時間を記録
        window.onload = () => {
            // IP呼び出し
            const userIP = localStorage.getItem("IP") || "Unknown";            
            // ブラウザ固有ID呼び出し
            const uniqueID = localStorage.getItem("browserID") || "Unknown";            
            // ユーザー名呼び出し
            const username = localStorage.getItem("username") || "Unknown";   
            // 被験者ID呼び出し
            const participantId = localStorage.getItem("participantId") || "Unknown";
            // タイムスタンプ取得
            const timestamp = new Date().toISOString();
            // 回答を配列に保存
            responses.push({ 
                IP: userIP,
                browserID: uniqueID,
                username: username,
                id: participantId,
                value: 0, 
                time: timestamp,
                page: 99 // ページフラグを追加 
            }); // 回答内容とタイムスタンプを保存
            // sessionStorage に保存
            sessionStorage.setItem("responses", JSON.stringify(responses));
        };        
        function checkInputAndProceed() {
            const input = document.getElementById("understand_key").value.trim();
            // sessionStorageからデータを取得
            const responses = JSON.parse(sessionStorage.getItem("responses")) || [];
            // IP呼び出し
            const userIP = localStorage.getItem("IP") || "Unknown";            
            // ブラウザ固有ID呼び出し
            const uniqueID = localStorage.getItem("browserID") || "Unknown";
            // ユーザー名呼び出し
            const username = localStorage.getItem("username") || "Unknown";            
            // 被験者ID呼び出し
            const participantId = localStorage.getItem("participantId") || "Unknown";

            // 「回答方法を理解した」が入力されているかチェック
            if (input === "回答方法理解回答方針理解謝金同意") {
                responses.push({
                    IP: userIP,
                    browserID: uniqueID,
                    username: username,
                    id: participantId,
                    value: "understood",
                    time: new Date().toISOString(),
                    page: 0
                });
                // sessionStorage に保存
                sessionStorage.setItem("responses", JSON.stringify(responses));


                alert("確認しました。次のページに進みます。");

                // ページ遷移を許可
                allowNavigation = true;
                window.location.href = "reading_time_1.html"; // 次ページへ遷移
            } else {
                alert("正しく入力してください");
            }
        }

        // ページを離れる前に警告を表示
        window.addEventListener("beforeunload", function (event) {
            if (allowNavigation) {
                // フラグが true の場合は警告を出さない
                return;
            }
            // 警告メッセージを設定
            const message = "このページを離れますか？実験が正常に終了できません。";

            // 標準的なブラウザの挙動のために以下を設定
            event.preventDefault();
            event.returnValue = message; // 古いブラウザ用の設定（多くのブラウザで無視される）

            return message; // 最新のブラウザ用（Chromeなどでは無視されることが多い）
        });
    </script>
</body>
</html>
